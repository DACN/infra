# Put your host names here
# all_hosts = [ 'localhost' ]
#all_hosts = [ "s074.okserver.org", "ansible-dev.okserver.org" ]

all_hosts = [ 
{% for host in groups['sysadmin-servers'] %}
"{{ host }}",
{% endfor %}
{% for host in groups['ckan']  %}
"{{ host }}",
{% endfor %}
{% for host in groups['openspending'] %}
"{{ host }}",
{%endfor%}
]


legacy_checks = [
#CKAN webservices
{% for host in groups['ckan-web-prod'] %}
  {% if hostvars[host]['sites_to_monitor'] is defined %}
    {% for site in hostvars[host]['sites_to_monitor'] %} 
( ( "check_http_basic!{{ site }}", "{{ site }}", False), [ "{{ host }}" ] ),
    {% endfor %}
  {% endif %}
{% endfor %}


#Openspending webervices
{% for host in groups['openspending-web'] %}
  {% if hostvars[host]['sites_to_monitor'] is defined %}
    {% for site in hostvars[host]['sites_to_monitor'] %} 
( ( "check_http_basic!{{ site }}", " {{ site }}", False), [ "{{ host }}" ] ),
    {% endfor %}
  {% endif %}
{% endfor %}


#( ( "check-tcp", "POSTGRES", False), [ {% for host in groups['dbservers'] %} "{{ host }}", {%endfor%} ]  ),

]

define_hostgroups = True
define_hostgroups = {
 "Sysadmin-servers" : "These servers are not specific to any project.",
 "CKAN-Servers" : "These servers run CKAN.",
 "Openspending-Servers" : "These servers run Openspending and related webservices."
}

host_groups = [

('Sysadmin-Servers', [ {% for host in groups['sysadmin-servers'] %} '{{ host }}', {% endfor %} ] ), 
('CKAN-Servers', [ {% for host in groups['ckan']  %} '{{ host }}', {% endfor %} ] ),
('Openspending-Servers', [ {% for host in groups['openspending'] %} '{{ host }}', {% endfor %} ] ),

]

define_contactgroups = True
define_contactgroups = {
 "sysadmin" : "Le BOFH",
 "CKAN-sysadmin" : "CKAN product owner sysadmins",
 "Openspending-sysadmin" : "Openspending product owner sysadmins",
}

host_contactgroups = [

('sysadmin', [ {% for host in groups['sysadmin-servers'] %} '{{ host }}', {% endfor %} ] ),
('ckan-sysadmin', [ {% for host in groups['ckan']  %} '{{ host }}', {% endfor %} ] ),
('openspending-sysadmin', [ {% for host in groups['openspending'] %} '{{ host }}', {% endfor %} ] ),

]


extra_nagios_conf += r"""
define command{
        command_name    check_http_basic
        command_line    /usr/lib/nagios/plugins/check_http -H '$ARG1$'
}

define contact{
        name                            generic-contact
        service_notification_period     24x7
        host_notification_period        24x7
        service_notification_options    u,c,r,f
        host_notification_options       d,r,f,s
        service_notification_commands   notify-service-by-email
        host_notification_commands      notify-host-by-email
}

define contact {
	contact_name sysadmin
	use generic-contact
	email {{ sysadmin_email }}
}

define contact {
	contact_name ckan-sysadmin
        use generic-contact
	email  {{ ckan_sysadmin_email }}, {{ sysadmin_email }}
}

define contact {
	contact_name openspending-sysadmin
        use generic-contact
	email {{ openspending_sysadmin_email }}, {{ sysadmin_email }}
}

"""
