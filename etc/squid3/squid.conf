http_port 80 accel defaultsite=ckan.net vhost

# Cache peer definitions separated so they can differ for the cache clones.
include /etc/squid3/squid-peers.conf

acl redirector_sites dstdomain opendatachallenge.org
acl redirector_sites dstdomain coins.wheredoesmymoneygo.org
acl redirector_sites dstdomain ask.wheredoesmymoneygo.org 
acl redirector_sites dstdomain www.opendatamanual.org
acl redirector_sites dstdomain opendatasearch.org
acl redirector_sites dstdomain www.opendatasearch.org
acl redirector_sites dstdomain trac.openspending.org
acl redirector_sites dstdomain wiki.ckan.net
acl redirector_sites dstdomain ckan.net
acl redirector_sites dstdomain www.ckan.net
acl redirector_sites dstdomain iati.ckan.net
acl redirector_sites dstdomain openknowledgefoundation.org 
acl redirector_sites dstdomain www.openknowledgefoundation.org 
acl redirector_sites dstdomain ckanhosted.com
acl redirector_sites dstdomain www.ckanhosted.com
acl redirector_sites dstdomain dataprotocols.org
acl redirector_sites dstdomain weavinghistory.org
acl redirector_sites dstdomain bibliographica.org
acl redirector_sites dstdomain www.bibliographica.org
acl redirector_sites dstdomain bnb.bibliographica.org

# non-migrated ex-eu3 sites, see http://trac.okfn.org/ticket/926
acl downformaint_sites dstdomain be.ckan.net
acl downformaint_sites dstdomain bg.ckan.net
acl downformaint_sites dstdomain fi.ckan.net
acl downformaint_sites dstdomain el.ckan.net
acl downformaint_sites dstdomain gr.ckan.net
acl downformaint_sites dstdomain hu.ckan.net
acl downformaint_sites dstdomain lt.ckan.net
acl downformaint_sites dstdomain nz.ckan.net
acl downformaint_sites dstdomain pl.ckan.net
acl downformaint_sites dstdomain katalogdanych.centrumcyfrowe.pl
acl downformaint_sites dstdomain si.ckan.net
acl downformaint_sites dstdomain sl.ckan.net
acl downformaint_sites dstdomain southampton.ckan.net
acl downformaint_sites dstdomain dfid.wheredoesmymoneygo.org
acl downformaint_sites dstdomain openspending.eu
acl downformaint_sites dstdomain www.openspending.eu

acl eu1_sites dstdomain munin.okfn.org

acl eu2_sites dstdomain old.wheredoesmymoneygo.org
acl eu2_sites dstdomain ideas.okfn.org

# blog farm
acl s053_sites dstdomain blog.okfn.org
acl s053_sites dstdomain okfn.org
acl s053_sites dstdomain www.okfn.org
acl s053_sites dstdomain okfn.de
acl s053_sites dstdomain www.okfn.de
acl s053_sites dstdomain openbiblio.net
acl s053_sites dstdomain www.openbiblio.net
acl s053_sites dstdomain openarthistory.org
acl s053_sites dstdomain www.openarthistory.org
acl s053_sites dstdomain ckan.org
acl s053_sites dstdomain www.ckan.org
acl s053_sites dstdomain blog.ckan.org
acl s053_sites dstdomain bigclean.org
acl s053_sites dstdomain www.bigclean.org
acl s053_sites dstdomain opengovernmentdata.org 
acl s053_sites dstdomain www.opengovernmentdata.org
acl s053_sites dstdomain blog.openspending.org
acl s053_sites dstdomain openeconomics.net
acl s053_sites dstdomain www.openeconomics.net
acl s053_sites dstdomain planet.okfn.org
acl s053_sites dstdomain okcon.org
acl s053_sites dstdomain www.okcon.org
acl s053_sites dstdomain publicdomainreview.org
acl s053_sites dstdomain www.publicdomainreview.org
acl s053_sites dstdomain opendatacommons.org
acl s053_sites dstdomain www.opendatacommons.org
acl s053_sites dstdomain ogdcamp.org
acl s053_sites dstdomain www.ogdcamp.org
acl s053_sites dstdomain openliterature.net
acl s053_sites dstdomain www.openliterature.net
acl s053_sites dstdomain openaiddata.de
acl s053_sites dstdomain www.openaiddata.de
acl s053_sites dstdomain openglam.org
acl s053_sites dstdomain www.openglam.org
acl s053_sites dstdomain opendefinition.org
acl s053_sites dstdomain www.opendefinition.org
acl s053_sites dstdomain wheredoesmymoneygo.org
acl s053_sites dstdomain www.wheredoesmymoneygo.org

acl s022_sites dstdomain ca.ckan.net

# Migrated community CKANs, see http://trac.okfn.org/ticket/933
acl s057_sites dstdomain s057.okserver.org
acl s057_sites dstdomain cz.ckan.net
acl s057_sites dstdomain br.ckan.net
acl s057_sites dstdomain ie.ckan.net
acl s057_sites dstdomain no.ckan.net

acl eu4_sites dstdomain ordf.org
acl eu4_sites dstdomain www.ordf.org

acl s055_sites dstdomain s055.okserver.org
acl s055_sites dstdomain thedatahub.org
acl s055_sites dstdomain www.thedatahub.org

acl de01_sites dstdomain de.ckan.net
acl de01_sites dstdomain ckan.de
acl de01_sites dstdomain www.ckan.de
acl de01_sites dstdomain offenedaten.de
acl de01_sites dstdomain www.offenedaten.de

acl eu8_sites dstdomain at.ckan.net
acl eu8_sites dstdomain datenkatalog.at
acl eu8_sites dstdomain www.datenkatalog.at
acl eu8_sites dstdomain offener.datenkatalog.at
acl eu8_sites dstdomain it.ckan.net
acl eu8_sites dstdomain colorado.ckan.net

acl eu25_sites dstdomain publicdata.eu
acl eu25_sites dstdomain www.publicdata.eu
acl eu25_sites dstdomain static.publicdata.eu
acl eu9_sites dstdomain opencorrespondence.org
acl eu9_sites dstdomain www.opencorrespondence.org
acl eu9_sites dstdomain openshakespeare.org
acl eu9_sites dstdomain www.openshakespeare.org

acl eu12_sites dstdomain s012.okserver.org

acl eu13_sites dstdomain wiki.ckan.org
acl eu13_sites dstdomain wiki.okfn.org
acl eu13_sites dstdomain wiki.okfn.de
acl eu13_sites dstdomain wiki.openspending.org
acl eu13_sites dstdomain wiki.publicdata.eu
acl eu13_sites dstdomain board.okfn.org

acl eu17_sites dstdomain isitopendata.org
acl eu17_sites dstdomain www.isitopendata.org
acl eu17_sites dstdomain getthedata.org
acl eu17_sites dstdomain www.getthedata.org

acl eu19_sites dstdomain eu19.okfn.org  # dummy entry so acl is not empty
acl eu19_sites dstdomain nederland.ckan.net

acl s049_sites dstdomain wordpress.iatiregistry.org

#acl river_sites dstdomain semantic.ckan.net

acl us1_sites dstdomain trac-old.ckan.org  # depricated

acl us2_sites dstdomain us2.okfn.org  # dummy entry so acl is not empty

acl us2-4_sites dstdomain blog.openshakespeare.org

acl us9_sites dstdomain trac.ckan.org

acl us11_sites dstdomain semantic.ckan.net


acl admin src 127.0.0.1
acl admin src 46.51.189.76 # eu6 public address
acl admin src 10.227.95.5 # eu2
acl admin src 10.227.127.100 # eu8
acl admin src 10.227.38.29 # eu9
acl admin src 174.136.109.162 # styx.org
acl admin src 193.34.146.142 # s050
acl admindns srcdomain .whiteink.com 
acl PURGE method PURGE
http_access allow PURGE admin
http_access allow PURGE admindns
http_access deny PURGE

http_access allow redirector_sites
http_access allow downformaint_sites
http_access allow eu1_sites
http_access allow eu2_sites
http_access allow eu4_sites
http_access allow eu8_sites
http_access allow eu9_sites
http_access allow eu12_sites
http_access allow eu13_sites
http_access allow eu17_sites
http_access allow eu19_sites
http_access allow eu25_sites
#http_access allow river_sites
http_access allow us1_sites
http_access allow us2_sites
http_access allow us2-4_sites
http_access allow us9_sites
http_access allow us11_sites
http_access allow s022_sites
http_access allow s049_sites
http_access allow s053_sites
http_access allow s055_sites
http_access allow s057_sites
http_access allow de01_sites

cache_peer_access redirector allow redirector_sites
cache_peer_access redirector deny all
cache_peer_access downformaint allow downformaint_sites
cache_peer_access downformaint deny all
cache_peer_access eu1 allow eu1_sites
cache_peer_access eu1 deny all
cache_peer_access eu2 allow eu2_sites
cache_peer_access eu2 deny all
cache_peer_access eu4 allow eu4_sites
cache_peer_access eu4 deny all
cache_peer_access eu8 allow eu8_sites
cache_peer_access eu8 deny all
cache_peer_access eu9 allow eu9_sites
cache_peer_access eu9 deny all
cache_peer_access eu12 allow eu12_sites
cache_peer_access eu12 deny all
cache_peer_access eu13 allow eu13_sites
cache_peer_access eu13 deny all
cache_peer_access eu17 allow eu17_sites
cache_peer_access eu17 deny all
cache_peer_access eu19 allow eu19_sites
cache_peer_access eu19 deny all
cache_peer_access eu25 allow eu25_sites
cache_peer_access eu25 deny all
#cache_peer_access river allow river_sites
#cache_peer_access river deny all
cache_peer_access us1 allow us1_sites
cache_peer_access us1 deny all
cache_peer_access us2 allow us2_sites
cache_peer_access us2 deny all
cache_peer_access us2-4 allow us2-4_sites
cache_peer_access us2-4 deny all
cache_peer_access us9 allow us9_sites
cache_peer_access us9 deny all
cache_peer_access us11 allow us11_sites
cache_peer_access us11 deny all

cache_peer_access s022 allow s022_sites
cache_peer_access s022 deny all
cache_peer_access s049 allow s049_sites
cache_peer_access s049 deny all
cache_peer_access s053 allow s053_sites
cache_peer_access s053 deny all
cache_peer_access s055 allow s055_sites
cache_peer_access s055 deny all
cache_peer_access s057 allow s057_sites
cache_peer_access s057 deny all

cache_peer_access de01 allow de01_sites
cache_peer_access de01 deny all

negative_ttl 0 # do not cache negative hits

cache_mem 1024 MB
cache_dir ufs /var/spool/squid3 20000 255 255

access_log /var/log/squid3/access.log squid

# NB: the format for refresh_pattern is:
#   refresh_pattern [-i] regex min percent max [options]
#
# min and max are measured in *minutes*, not *seconds*

refresh_pattern ./*/revision/list/            30 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims
refresh_pattern http://planet.okfn.org/feed.* 60 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims
refresh_pattern http://planet.okfn.org/       60 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

# cache front page
refresh_pattern http://okfn.org/$ 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

# blog caching
refresh_pattern http://blog.okfn.org/page.*        15 0% 720 ignore-no-cache refresh-ims
refresh_pattern http://blog.okfn.org/[0-9][0-9].*  15 0% 720 ignore-no-cache refresh-ims
refresh_pattern http://blog.okfn.org/feed.*        15 0% 720 ignore-no-cache refresh-ims
refresh_pattern http://blog.okfn.org/category.*    15 0% 720 ignore-no-cache refresh-ims
refresh_pattern http://blog.okfn.org/wp-content/.* 15 0% 720 ignore-no-cache refresh-ims
refresh_pattern http://blog.okfn.org/$             15 0% 720 ignore-no-cache refresh-ims

refresh_pattern http://publicdata.eu/$ 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

# ckan force cache static
refresh_pattern http://ckan.net/$ 5 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims
refresh_pattern http://ckan.net/revision$ 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims
refresh_pattern http://ckan.net/images 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims
refresh_pattern http://ckan.net/scripts/vendor 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims
#refresh_pattern http://thedatahub.org/$ 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims
refresh_pattern http://thedatahub.org/images 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims
refresh_pattern http://thedatahub.org/scripts/vendor 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

refresh_pattern http://ckan.org/$ 60 0% 2880 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

refresh_pattern http://publicdomainreview.org/$ 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

refresh_pattern http://ogdcamp.org/$ 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

refresh_pattern http://getthedata.org/$ 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

