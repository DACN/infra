##################################################################
#
# FYI (s006.okserver.org) this is currently the only 
# OKFN squid cache. /nils
#
##################################################################


http_port 80 accel defaultsite=ckan.net vhost


##################################################################
# cache_peer definitions back in here
cache_peer 127.0.0.1 parent 8080 0 no-query originserver name=redirector
cache_peer 127.0.0.1 parent 8081 0 no-query originserver name=downformaint

cache_peer s009-int.okserver.org parent 80 0 no-query originserver name=s009
cache_peer s013-int.okserver.org parent 80 0 no-query originserver name=s013 login=PASS
cache_peer s079.okserver.org     parent 80 0 no-query originserver name=s079 login=PASS

cache_peer fragdenstaat.de       parent 80 0 no-query originserver name=de01 login=PASS
cache_peer dh4.okserver.org      parent 80 0 no-query originserver name=dh4


##################################################################
acl redirector_sites dstdomain opendatachallenge.org
acl redirector_sites dstdomain coins.wheredoesmymoneygo.org
acl redirector_sites dstdomain ask.wheredoesmymoneygo.org 
acl redirector_sites dstdomain opendatamanual.org
acl redirector_sites dstdomain www.opendatamanual.org
acl redirector_sites dstdomain opendatasearch.org
acl redirector_sites dstdomain www.opendatasearch.org
acl redirector_sites dstdomain wiki.ckan.net
acl redirector_sites dstdomain ckan.net
acl redirector_sites dstdomain www.ckan.net
acl redirector_sites dstdomain iati.ckan.net
acl redirector_sites dstdomain openknowledgefoundation.org 
acl redirector_sites dstdomain www.openknowledgefoundation.org 
acl redirector_sites dstdomain dataprotocols.org
acl redirector_sites dstdomain bibliographica.org
acl redirector_sites dstdomain www.bibliographica.org
acl redirector_sites dstdomain bnb.bibliographica.org
acl redirector_sites dstdomain m.okfn.org
acl redirector_sites dstdomain nederland.ckan.net
acl redirector_sites dstdomain irc.okfn.org
acl redirector_sites dstdomain ca.ckan.net
acl redirector_sites dstdomain si.ckan.net
acl redirector_sites dstdomain semantic.ckan.net
acl redirector_sites dstdomain datapatterns.org
acl redirector_sites dstdomain www.datapatterns.org
acl redirector_sites dstdomain isitopendata.org
acl redirector_sites dstdomain publicdomaincalculators.okfn.org
acl redirector_sites dstdomain weavinghistory.org
acl redirector_sites dstdomain bibjson.org
acl redirector_sites dstdomain colorado.ckan.net

acl downformaint_sites dstdomain notice.okfn.org
acl downformaint_sites dstdomain notice.ckan.org
# non-migrated ex-eu3 sites, see http://trac.okfn.org/ticket/926
acl downformaint_sites dstdomain be.ckan.net
acl downformaint_sites dstdomain bg.ckan.net
acl downformaint_sites dstdomain fi.ckan.net
acl downformaint_sites dstdomain el.ckan.net
acl downformaint_sites dstdomain gr.ckan.net
acl downformaint_sites dstdomain hu.ckan.net
acl downformaint_sites dstdomain nz.ckan.net
acl downformaint_sites dstdomain pl.ckan.net
acl downformaint_sites dstdomain katalogdanych.centrumcyfrowe.pl
acl downformaint_sites dstdomain sl.ckan.net
acl downformaint_sites dstdomain southampton.ckan.net
acl downformaint_sites dstdomain dfid.wheredoesmymoneygo.org

# s009/eu9 
acl s009_sites dstdomain opencorrespondence.org
acl s009_sites dstdomain www.opencorrespondence.org
acl s009_sites dstdomain openshakespeare.org
acl s009_sites dstdomain www.openshakespeare.org

# s013/eu13: wiki farm
acl s013_sites dstdomain wiki.ckan.org
acl s013_sites dstdomain wiki.okfn.org
acl s013_sites dstdomain wiki.okfn.de
acl s013_sites dstdomain wiki.openspending.org
acl s013_sites dstdomain board.okfn.org
acl s013_sites dstdomain methods.okfn.org
acl s013_sites dstdomain oldwiki.okfn.org
acl s013_sites dstdomain wiki.offenerhaushalt.de
acl s013_sites dstdomain wiki.openliterature.net

# s077: new ckan farm
acl s079_sites dstdomain publicdata.eu
acl s079_sites dstdomain www.publicdata.eu

# de01/fragdenstaat.de
acl de01_sites dstdomain de.ckan.net
acl de01_sites dstdomain offenedaten.de
acl de01_sites dstdomain www.offenedaten.de

# dh4/us2-4 (http://trac.okfn.org/ticket/655)
acl dh4_sites  dstdomain blog.openshakespeare.org


##################################################################
acl admin src 127.0.0.1
acl admin src 10.227.38.29 # s009
acl admindns srcdomain .whiteink.com 
acl PURGE method PURGE
http_access allow PURGE admin
http_access allow PURGE admindns
http_access deny PURGE


##################################################################
http_access allow redirector_sites
http_access allow downformaint_sites
http_access allow s009_sites
http_access allow s013_sites
http_access allow s079_sites
http_access allow de01_sites
http_access allow dh4_sites


##################################################################
cache_peer_access redirector allow redirector_sites
cache_peer_access redirector deny all
cache_peer_access downformaint allow downformaint_sites
cache_peer_access downformaint deny all
cache_peer_access s009 allow s009_sites
cache_peer_access s009 deny all
cache_peer_access s013 allow s013_sites
cache_peer_access s013 deny all
cache_peer_access s079 allow s079_sites
cache_peer_access s079 deny all

cache_peer_access de01 allow de01_sites
cache_peer_access de01 deny all
cache_peer_access dh4  allow dh4_sites
cache_peer_access dh4  deny all


##################################################################
negative_ttl 0 # do not cache negative hits

cache_mem 1024 MB
cache_dir ufs /var/spool/squid3 20000 255 255

access_log /var/log/squid3/access.log squid


##################################################################
# NB: the format for refresh_pattern is:
#   refresh_pattern [-i] regex min percent max [options]
#
# min and max are measured in *minutes*, not *seconds*

refresh_pattern http://publicdata.eu/$ 15 0% 720 override-expire override-lastmod ignore-no-cache ignore-no-store ignore-reload ignore-private reload-into-ims

