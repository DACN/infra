<VirtualHost *:80>
    ServerName ckan.net
    ServerAlias www.ckan.net
    ServerAlias thedatahub.org www.thedatahub.org

    Alias /dump /home/okfn/var/srvc/ckan.net/dumps
    RedirectMatch permanent /package/read/(.*)$ http://ckan.net/package/$1

    RewriteEngine on
    RewriteCond %{HTTP_HOST} ^www\.ckan\.net$ [NC]
    RewriteRule ^(.*)$ http://ckan.net$1 [R=301,L]
    RewriteCond %{HTTP_HOST} ^www\.thedatahub\.org$ [NC]
    RewriteRule ^(.*)$ http://thedatahub.org$1 [R=301,L]

    # CORS stuff for DataDeck etc
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "POST, PUT, GET, OPTIONS"
    Header always set Access-Control-Allow-Headers "X-CKAN-API-KEY"
    # Respond to all OPTIONS requests with 200 OK
    # This could be done in the webapp
    # This is need for pre-flighted requests (POSTs/PUTs)
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]

    # hacks to control java robot that is hammering the site 2010-05-07
    <Location />
    Deny from 64.93.41.50
    Deny from 76.87.90.4
    </Location>

    # <LocationMatch ^/package/rate.*>
    #    Deny from all
    #</LocationMatch>

RewriteEngine on
RewriteCond %{HTTP_user_agent} Java/1.6.0_20 [NC]
RewriteRule .* - [F] 
    # end hacks

    # Disable the mod_python handler for static files
    <Location /dump>
        SetHandler None
        Options +Indexes
    </Location>

    WSGIScriptAlias / /home/okfn/var/srvc/ckan.net/pyenv/bin/ckan.net.py
    WSGIDaemonProcess ckan.net display-name=ckan.net processes=10 threads=1 maximum-requests=25
    WSGIProcessGroup ckan.net

    # pass authorization info on (needed for rest api)
    WSGIPassAuthorization On

    ErrorLog /var/log/apache2/ckan.net.error.log
    CustomLog /var/log/apache2/ckan.net.custom.log combined
</VirtualHost>
