# HTTP
<VirtualHost *:80>
  ServerName lists.okfn.org
  AddHandler cgi-script .cgi

  ScriptAlias /mailman/ /var/lib/mailman/cgi-bin/
  RedirectMatch permanent /cgi-bin/(.*) /$1

  Alias /pipermail /var/lib/mailman/archives/public
  <Directory /var/lib/mailman/archives/public>
    AllowOverride Options
    Options FollowSymLinks
  </Directory>

  Alias /images/mailman /usr/share/images/mailman
  <Location /images/mailman>
    order allow,deny
    allow from all
  </Location>

  Redirect /mailman/listinfo/wdmmg-discuss http://lists.okfn.org/mailman/listinfo/openspending
  RedirectMatch /pipermail/wdmmg-discuss/(.*)$ http://lists.okfn.org/pipermail/openspending/$1
  Redirect /mailman/listinfo/wdmmg-dev http://lists.okfn.org/mailman/listinfo/openspending-dev
  RedirectMatch /pipermail/wdmmg-dev/(.*)$ http://lists.okfn.org/pipermail/openspending-dev/$1
  Redirect /mailman/listinfo/open-data-manual http://lists.okfn.org/mailman/listinfo/open-data-handbook
  RedirectMatch /pipermail/open-data-manual/(.*)$ http://lists.okfn.org/pipermail/open-data-handbook/$1
  RedirectMatch permanent ^/$ http://lists.okfn.org/mailman/listinfo
    ErrorLog /var/log/apache2/lists.okfn.org.error.log
    CustomLog /var/log/apache2/lists.okfn.org.log combined
</VirtualHost>

# HTTPS
<VirtualHost *:443>
  ServerName lists.okfn.org
  AddHandler cgi-script .cgi

  <IfModule mod_ssl.c>
    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/okfn.org.cert
    SSLCertificateKeyFile /etc/apache2/ssl/okfn.org.key
    <Files ~ "\.(cgi|shtml)$">
      SSLOptions +StdEnvVars
    </Files>
    <Directory "/usr/lib/cgi-bin">
      SSLOptions +StdEnvVars
    </Directory>
    SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown
  </IfModule>

  ScriptAlias /mailman/ /var/lib/mailman/cgi-bin/
  RedirectMatch permanent /cgi-bin/(.*) /$1

  Alias /pipermail /var/lib/mailman/archives/public
  <Directory /var/lib/mailman/archives/public>
    AllowOverride Options
    Options FollowSymLinks
  </Directory>

  Alias /images/mailman /usr/share/images/mailman
  <Location /images/mailman>
    order allow,deny
    allow from all
  </Location>

  RedirectMatch permanent ^/$ https://lists.okfn.org/mailman/listinfo
    ErrorLog /var/log/apache2/lists.okfn.org.error.log
    CustomLog /var/log/apache2/lists.okfn.org.log combined
</VirtualHost>
