#ansible-playbook main.yml --tags="base-roles" -vvv
---

- hosts: openspending-web
  sudo: true
  vars_files:
    - "{{ private_dir }}/p.yml"
  roles:
    - base-role
    - varnish
    - nginx
    - statsd

- hosts: s113.okserver.org
  sudo: true
  vars_files:
    - "{{ private_dir }}/p.yml"
  roles:
    - base-role
    - role: etherpad-lite
      install_path: /var/www/etherpad-lite
      user: etherpad-lite
      group: etherpad-lite
      version: 1.2.11

- hosts: backup
  sudo: true
  roles:
    - base-role
    - role: rsnapshot
      snapshot_root: /home/backup/snapshots/
      cmd_rsync: /usr/bin/rsync

- hosts: ansible-dev
  sudo: true
  roles:
    - base-role
    - role: booktype
      install_path: /var/www/mybooktype
      user: booktype
      group: booktype
    - graphite

- hosts: wiki
  gather_facts: false
  sudo: true
  roles:
    - base-role
    - nginx

- hosts: monitoring
  sudo: true
  vars_files:
    - vars/users.yml
    - "{{ private_dir }}/p.yml"
  roles:
    - base-role
    - nagios-server
    - check_mk-server

- hosts: mail
  sudo: true
  tasks:
    - action: debug msg="mailserver!"

- hosts: listserv
  sudo: true
  vars_files:
    - vars/users.yml
    - "{{ private_dir }}/p.yml"
  vars:
    mailhost_type: leaf
    relayhost: false
    ses: false
    origin: okfn.org
    listserv: true
    transport: list_transport
    relay_domains:
      - lists.okfn.org
      - lists.knowledgeforge.net
      - lists.dataexpeditions.org
    listserv_host: lists.okfn.org
  roles:
    - postfix
    - nginx
    - mailman

- hosts: docker-host
  sudo: true
  vars_files:
    - vars/users.yml
    - "{{ private_dir }}/p.yml"
  roles:
    - base-role
    - postfix
    - docker
    - { role: nginx, tags: ['nginx'] }
