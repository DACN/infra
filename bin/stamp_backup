#!/bin/bash

set -eu

. /etc/backup/backuprc

BACKUP_DIR=${SNAPSHOT_RO}/$(hostname -s)/daily.0
STAMP_DIR=/etc/.backup_stamp
FMT=+%Y-%m-%d

clean () {
	rm -f -- ${STAMP_DIR}/*-*-*
}

create () {
	mkdir -p ${STAMP_DIR}
	clean
	touch ${STAMP_DIR}/$(date ${FMT})
}

check () {
	[ -f ${BACKUP_DIR}/${STAMP_DIR}/$(date --date='yesterday' ${FMT}) ]
}

usage () {
	echo $0 '[--set|--check]'
	exit 1
}

case "$1" in
	--check) check ;;
	--set) create ;;
	*) usage ;;
esac
